# 数据驱动的混部数据中心资源管理技术研究

标签：论文 资源预测

关注点是混合部署，将在线服务预留的闲置资源用来部署离线计算任务，提高数据中心的资源利用率。
对于公有云服务提供商而言，本质就是超卖。

这就需要对在线服务的资源和负载作出准确预测

方法：引入了多时间序列负载预测模型MLA-LSTM，引入了注意力机制。
关注点：挖掘多个时间序列在数据中心部署架构上的协作关系和竞争关系

## 绪论部分

### 背景

数据中心的服务器利用率很低（平均为6%~12%）

混合部署技术：一方面需要部署响应及时的交互式在线服务；另一方面，也需要运行各类数据分析等时延不敏感的离线计算任务。

背景：在线服务器的CPU平均利用在30%，阿里巴巴因为预留资源，利用率只有10%。而离线计算任务服务器集群能达到75%以上。

混合部署的目的是为了消除在线服务的资源浪费。主张将在线服务在负载峰值之外的闲时资源回收回来，提供给时延不敏感的离线计算任务。

挑战点：要求保证在线服务的服务质量在可忍受范围内，所以需要对在线服务的未来资源需求和负载情况进行预测，提前给请求峰波预留足够的资源从而保证在线服务的服务质量。

例如：Borg，阿里巴巴的Sigma-Fuxi和百度的Matrix系统。

### 研究意义

混合部署需要精确的预测集群内在线服务的资源需求。

重点：在线服务的资源负载预测

* 目前负载和资源需求预测采用的时间序列分析模型，例如ARIMA、贝叶斯模型和LSTM。
* 缺点：采用通用的单时间序列预测模型。只依靠自身的历史信息特征进行预测，没有很好地考虑到部署在数据中心内的多种实例负载之间的相互影响和相互关系。
* 导致的问题：在实际的负载预测过程中，预测性能受限于自身历史数据的有效性，特别是在环境变化剧烈的数据中心环境中，预测性能非常受限。
* 改进：针对数据中心的应用部署特点和领域知识来设计新的预测模型。

在负载预测的基础上，混合部署系统还要考虑如何组合离线计算服务和在线服务。

### 论文工作介绍

1. 分析了数据中心的应用部署特点，根据这些特点来设计基于深度学习的在线服务负载预测模型。（用多个相关的负载时间序列作为模型特征来改善预测性能）
2. 针对数据中心混部部署的场景，在基于负载预测的信息下设计混部部署调度算法，目标是尽可能提高混合部署集群的资源利用效率。

#### 第一部分

大规模服务由多个小服务组成，在微服务架构下，一个在线服务需要根据业务逻辑使用大量的微服务组合而成。

应用实例的关系：协作关系和竞争关系。
* 协作关系：需要协作共同提供计算服务的应用实例之间，比如一些无状态的在线服务通常使用多个应用副本进行负载均衡，应用副本实例共同承担一个服务的负载，同步增减
* 竞争关系：存在于需要相互竞争资源的应用实例之间。典型案例是目前受限于计算机体系架构，资源隔离技术无法避免应用之间在缓存、CPU、内存和网络带宽等资源上的竞争和干扰。

这两种关系可以用来提供一定的预测先验知识，提高负载预测的准确度。

#### 第二部分

混部部署场景下的在线和离线任务的部署特点，设计了一个基于强化学习的调度算法。

## 研究现状

### 时间序列预测模型与负载预测

单时间序列预测：ARIMA等模型

机器学习方法：支持向量机和基于集成学习的回归决策树。

深度学习：LSTM和GRU，可以学习时间序列的前后自相关性。

模型：seq2seq (Sequence to Sequence Learning with Neural Network)，带有注意力的seq2seq网络(Neural Machine Translation by Jointly Learning to Align and Translate)、PixelRNN (Pixel Recurrent Network)、WaveNet(WaveNet: A Generative Model for Raw Audio)

TCN

单时间序列负载预测：只考虑目标时序的自相关性来实现负载预测

问题：没有对数据中心的特点进行深入分析，从而设计出符合数据中心特点的负载预测模型。只考虑单个时间序列的负载，注定会受到影响。

### 多时间序列预测模型

常见的统计模型是VAR Vector AR，基于平稳性假设。

更多的是深度学习，带注意力的深度学习模型，用于比如在股票预测领域

用组合聚类技术来识别不同负载之间的关系，用马尔科夫链建模...

基本只是基于一些简单技术手段或是已有模型的组合，没有一个端到端的、针对数据中心的多时间序列预测模型。

提出了MLA-LSTM，针对数据中心内不同应用的负载类型，挖掘时间序列之间的相关性。

### 2.1.5 注意力机制与多时间序列预测

注意力机制可以被看作是一种模拟人类视觉感受的一种仿生技术，有从全局信息聚焦局部关键信息的作用。

### 强化学习和云资源管理

优化目标：
1. 降低任务调度的等待时间
2. 保证服务QoS
3. 降低数据中心能耗。

## 第3章 多时间序列预测负载模型

场景：
1. 一个服务由多个具备相同功能的副本实例组成。显然，服务请求量增大的时候，它们的资源使用量会同步增大
2. 一个服务下的组成实例，具有前后关系。当服务请求量增大，前置实例资源使用量增大，也可能会导致后置资源使用量增大。正相关地升高，具有一定的前后时间差。

假设2：同一个机器的不同实例无法绝对隔离，存在资源竞争。
同属于一个物理主机、不同服务的实例之间会互相警长资源。

使用注意力机制来识别这种关系，使得预测更加准确。

## 第4章 混部环境的离线任务调度算法

使用强化学习

model-free方法
* 针对策略拟合，策略优化算法：REINFORCE、TROP、A3C
* 拟合最优价值函数的算法：Q-Learning和DQN
* 拟合两者以上的算法：Actor-Criti系列，包括DDPG等

近年来的代表思想是DQN

### 状态空间设计

（服务器，任务）匹配元组组成的列表，每个元组包括：
* 数据中心内多个服务器的未来资源可用量，通过负载预测模型预测和计算得来。（仅考虑单种资源，如CPU占用率）
* 待调度的任务信息：考虑任务队列最前面的j个任务，第j个任务的计算运行时间dj

### 行为空间设计

任务：将队列中前J个任务全部调度到具体服务器上，是一个“任务-服务器”匹配过程

将智能体的一次行为决策看作是一个任务选择一个服务器来运行，M个服务器的话有M*J+1种选择，包含一个空的决策。

### 奖励函数设计和优化目标

优化目标是提高数据中心的资源利用率。但单纯使用资源利用率难以衡量数据中心资源管理的优劣性（在限制资源可以满足所提交的离线任务资源需求总量时，任意调度方式计算出的资源利用率是相同的）

考虑使用makespan作为优化目标，即完工时间，指从开始调度到所有任务执行完成中间经历的时间长度。而且，最小化makespan几乎等同于最大化资源效率